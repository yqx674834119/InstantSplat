# InstantSplat API ç›®å½•ç»“æ„é‡ç»„è®¡åˆ’

## é—®é¢˜åˆ†æ

æ ¹æ® `/home/livablecity/InstantSplat/scripts/run_infer.sh` è„šæœ¬çš„è¦æ±‚ï¼ŒInstantSplat éœ€è¦ç‰¹å®šçš„ç›®å½•ç»“æ„ï¼š

### æ ‡å‡†ç›®å½•ç»“æ„
```
DATA_ROOT_DIR/
â””â”€â”€ DATASET/
    â””â”€â”€ SCENE/
        â”œâ”€â”€ images/           # è¾“å…¥å›¾åƒæ–‡ä»¶
        â”‚   â”œâ”€â”€ 000000.jpg
        â”‚   â”œâ”€â”€ 000001.jpg
        â”‚   â””â”€â”€ ...
        â””â”€â”€ sparse_3/         # å‡ ä½•åˆå§‹åŒ–ç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶
            â””â”€â”€ 0/
                â”œâ”€â”€ cameras.bin
                â”œâ”€â”€ images.bin
                â”œâ”€â”€ points3D.bin
                â”œâ”€â”€ confidence_dsp.npy
                â””â”€â”€ ...
```

### è¾“å‡ºç›®å½•ç»“æ„
```
output_infer/
â””â”€â”€ DATASET/
    â””â”€â”€ SCENE/
        â””â”€â”€ N_views/          # å¦‚ 3_views
            â”œâ”€â”€ 01_init_geo.log
            â”œâ”€â”€ 02_train.log
            â”œâ”€â”€ 03_render.log
            â””â”€â”€ ...
```

## å½“å‰é—®é¢˜

1. **æ–‡ä»¶å­˜å‚¨ä½ç½®ä¸ç¬¦åˆæ ‡å‡†**ï¼šå½“å‰APIå°†æ–‡ä»¶å­˜å‚¨åœ¨ `temp/task_id/` ç›®å½•ä¸‹ï¼Œä¸ç¬¦åˆInstantSplatçš„æ ‡å‡†ç›®å½•ç»“æ„
2. **è·¯å¾„ä¼ é€’é”™è¯¯**ï¼šReconstructionProcessorä¼ é€’çš„è·¯å¾„ä¸ç¬¦åˆè„šæœ¬æœŸæœ›çš„æ ¼å¼
3. **ä¸­é—´æ–‡ä»¶è·¯å¾„ä¸åŒ¹é…**ï¼šè®­ç»ƒè„šæœ¬æœŸæœ›åœ¨ `sparse_N/0/` ç›®å½•ä¸­æ‰¾åˆ°æ–‡ä»¶ï¼Œä½†å®é™…ç”Ÿæˆåœ¨å…¶ä»–ä½ç½®

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®æ”¹é…ç½®æ–‡ä»¶ (config.py)

æ·»åŠ æ–°çš„ç›®å½•é…ç½®ï¼š
```python
# InstantSplatæ ‡å‡†ç›®å½•ç»“æ„
ASSETS_DIR = BASE_DIR / "assets"  # DATA_ROOT_DIR
DATASET_NAME = "api_uploads"      # ç»Ÿä¸€çš„æ•°æ®é›†åç§°
```

### 2. ä¿®æ”¹APIæœåŠ¡å™¨ (api_server.py)

é‡æ–°ç»„ç»‡æ–‡ä»¶ä¸Šä¼ é€»è¾‘ï¼š
- ä½¿ç”¨ `assets/api_uploads/task_id/images/` ä½œä¸ºè¾“å…¥ç›®å½•
- ç¡®ä¿å›¾åƒæ–‡ä»¶æŒ‰é¡ºåºå‘½åï¼ˆ000000.jpg, 000001.jpg, ...ï¼‰

### 3. ä¿®æ”¹ReconstructionProcessor (reconstruction_processor.py)

æ›´æ–°å¤„ç†é€»è¾‘ï¼š
- ä¿®æ”¹ `_prepare_input_directory` æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨æ ‡å‡†ç›®å½•ç»“æ„
- æ›´æ–°è„šæœ¬è°ƒç”¨å‚æ•°ï¼Œä½¿ç”¨æ­£ç¡®çš„æºè·¯å¾„å’Œæ¨¡å‹è·¯å¾„
- ç¡®ä¿ `n_views` å‚æ•°æ­£ç¡®ä¼ é€’

### 4. å…·ä½“ä¿®æ”¹å†…å®¹

#### 4.1 ç›®å½•ç»“æ„æ˜ å°„

| åŸç»“æ„ | æ–°ç»“æ„ |
|--------|--------|
| `temp/task_id/filename` | `assets/api_uploads/task_id/images/000000.ext` |
| `output_api/task_id/` | `output_infer/api_uploads/task_id/3_views/` |

#### 4.2 è„šæœ¬å‚æ•°è°ƒæ•´

- `SOURCE_PATH`: `assets/api_uploads/task_id/`
- `MODEL_PATH`: `output_infer/api_uploads/task_id/3_views/`
- `IMAGE_PATH`: `assets/api_uploads/task_id/images/`

## å®æ–½æ­¥éª¤

1. âœ… åˆ†æç°æœ‰ä»£ç å’Œç›®å½•ç»“æ„
2. ğŸ”„ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æ–°çš„ç›®å½•é…ç½®
3. ğŸ”„ æ›´æ–°APIæœåŠ¡å™¨çš„æ–‡ä»¶ä¸Šä¼ é€»è¾‘
4. ğŸ”„ ä¿®æ”¹ReconstructionProcessorçš„å¤„ç†é€»è¾‘
5. ğŸ”„ æµ‹è¯•æ–°çš„ç›®å½•ç»“æ„æ˜¯å¦æ­£å¸¸å·¥ä½œ
6. ğŸ”„ æ›´æ–°æ–‡æ¡£å’Œæ—¥å¿—è®°å½•

## é¢„æœŸæ•ˆæœ

ä¿®æ”¹å®Œæˆåï¼ŒAPIå°†ï¼š
1. æŒ‰ç…§InstantSplatæ ‡å‡†ç›®å½•ç»“æ„å­˜å‚¨æ–‡ä»¶
2. æ­£ç¡®ä¼ é€’è·¯å¾„å‚æ•°ç»™å¤„ç†è„šæœ¬
3. ç¡®ä¿ä¸­é—´æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®ç”Ÿæˆ
4. æé«˜ä¸åŸå§‹InstantSplatè„šæœ¬çš„å…¼å®¹æ€§

---

**åˆ›å»ºæ—¶é—´**: 2025-01-09
**ä¿®æ”¹äºº**: InstantSplat API Team
**çŠ¶æ€**: è¿›è¡Œä¸­